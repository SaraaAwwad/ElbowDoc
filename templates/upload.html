<!DOCTYPE html>
<html lang="zxx" class="no-js">
<head>
	<!-- Mobile Specific Meta -->
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- Favicon-->
	<link rel="shortcut icon" href="img/fav.png">
	<!-- Author Meta -->
	<meta name="author" content="CodePixar">
	<!-- Meta Description -->
	<meta name="description" content="">
	<!-- Meta Keyword -->
	<meta name="keywords" content="">
	<!-- meta character set -->
	<meta charset="UTF-8">
	<!-- Site Title -->
	<title>Upload</title>

	<link href="https://fonts.googleapis.com/css?family=Poppins:100,300,500" rel="stylesheet">
		<!--
		CSS
		============================================= -->

		<link rel="stylesheet" href="{{ url_for('static',filename='css/linearicons.css') }}">
		<link rel="stylesheet" href="{{ url_for('static',filename='css/owl.carousel.css') }}">
		<link rel="stylesheet" href="{{ url_for('static',filename='css/font-awesome.min.css') }}">
		<link rel="stylesheet" href="{{ url_for('static',filename='css/nice-select.css') }}">
		<link rel="stylesheet" href="{{ url_for('static',filename='css/magnific-popup.css') }}">
		<link rel="stylesheet" href="{{ url_for('static',filename='css/bootstrap.css') }}">
		<link rel="stylesheet" href="{{ url_for('static',filename='css/main.css') }}">

<style>
input[type="file"] {
    display: none;
}
.custom-file-upload {
    border: 1px solid #ccc;
    display: inline-block;
    padding: 6px 12px;
    cursor: pointer;
}
</style>

	<title>Upload</title>

    <script src="../static/jquery.min.js"></script>
    <script src="../static/jquery.Jcrop.js"></script>

</head>
	<body class="dup-body">
		<div class="dup-body-wrap">
			<!-- Start Header Area -->
			<header class="default-header">
				<div class="header-wrap">
					<div class="header-top d-flex justify-content-between align-items-center">
						<div class="logo">
							<a href="index.html"><img src="../static/img/Final.png" width = "60" height="60" alt=""></a>
						</div>
						<div class="main-menubar d-flex align-items-center">
							<nav class="hide">
								<a href="index.html">Home</a>
								<a href="generic.html">Classify</a>
								<a href="elements.html">Patients</a>
							</nav>
							<div class="menu-bar"><span class="lnr lnr-menu"></span></div>
						</div>
					</div>
				</div>
			</header>
		<!-- End Header Area -->

		<!-- Start Banner Area -->
		<section class="banner-area relative">
			<div class="overlay overlay-bg"></div>
			<div class="container">
				<div class="row fullscreen align-items-center justify-content-between">
					<div class="col-lg-6 col-md-7 col-sm-8">
						<div class="banner-content">
							<h1 style="font-size:100px;">ElbowDoc <br> </h1>
							<p style="font-size:25px;">Automatic recognition of elbow disorders from radiographs. </p>
							<a href="#ach" class="primary-btn" style="font-size:20px;">Get Started<span class="lnr lnr-arrow-right"></span></a>
						</div>
					</div>
					<div class="col-lg-5 col-md-5 col-sm-4">
						<img src="../static/img/elbow-1.png" alt="" class="img-fluid">
					</div>
				</div>
			</div>
		</section>
		<!-- End Banner Area -->

		<!-- Start studio Area -->
		<section class="section-gap studio-area studio-area1" id = "ach">
			<div class="overlay overlay-bg"></div>
			<div class="container" >
				<div class="row align-items-center">
					<div class="col-md-4 col-sm-6 text-center">
						<div class="studio-thumb">
							<img src="../static/img/femdoctor.png" class="img-fluid" alt="">
						</div>
					</div>
					<div class="col-md-8 col-sm-6">
						<div class="studio-content">
							<h2 style="font-size:35px;">Classify Case</h2>
							<p style="font-size:20px;">To start classifying a new case, please insert an xray image of the elbow.</p>

                        </div>
					</div>
				</div>
			</div>
		</section>
		<!-- End studio Area -->

		<!-- Start Achivement Area -->
		<section class="section-gap achivement-area" style="padding-bottom: 0px; ">
			<div class="container">
				<div class="row align-items-center">
					<div class="col-lg-5">
						<div class="achivement-content">
													<label class="custom-file-upload">
                            <input type="file"  id="file" class="primary-btn"/>
							<p style="font-size:20px;font-weight:bold;">Select Image <span class="lnr lnr-camera"></span></p>
                        </label>

							<div id="views"></div>
							<a class="primary-btn clearbutton" style="margin: 20px;">Classify<span class="lnr lnr-arrow-right"></span></a>
                        		<p id="result" style="color: black; font-size:35px; float:left;"></p>
                                <strong><p id="datares" style="color: red;  font-size:35px; float:left;"></p></strong>


						</div>
					</div>

					<div class="col-lg-6">
						<div class="total-achivement">
							<div class="row" >

<div class="col-md-12 col-sm-6">



</div>
								<div class="col-md-4 col-sm-6">
									<div class="single-achivement">
										<a id="cropbutton" class="achivement-link">
											<img src="../static/img/cropicon.png"  height="130" width="130" alt="" class="img-fluid">
										</a>
										<h6><a href="#">Crop</a></h6>
									</div>
								</div>

								<div class="col-md-4 col-sm-6">
									<div class="single-achivement">
										<a id="scalebutton" class="achivement-link">
											<img src="../static/img/scaleicon.png" height="130" width="130" alt="" class="img-fluid">
										</a>
										<h6><a href="#" >Scale</a></h6>
									</div>
								</div>
								<div class="col-md-4 col-sm-6">
									<div class="single-achivement">
										<a id="rotatebutton" class="achivement-link">
											<img src="../static/img/rotateicon.png" height="130" width="130" alt="" class="img-fluid">
										</a>
										<h6><a href="#" >Rotate</a></h6>
									</div>
								</div>
								<div class="col-md-4 col-sm-6">
									<div class="single-achivement">
										<a id="hflipbutton" class="achivement-link">
											<img src="../static/img/horizontalicon.png" height="130" width="130" alt="" class="img-fluid">
										</a>
										<h6><a href="#" >Horizontal Flip</a></h6>
									</div>
								</div>

								<div class="col-md-4 col-sm-6">
									<div class="single-achivement">
										<a id="vflipbutton" class="achivement-link">
											<img src="../static/img/verticalicon.png"  height="130" width="130" alt="" class="img-fluid">
										</a>
										<h6><a href="#" >Vertical Flip</a></h6>
									</div>
								</div>

							</div>

						</div>
					</div>
				</div>
			</div>
            <hr>
		</section>


            <section class="section-gap studio-area studio-area2" id = "retrain">
			<div class="overlay overlay-bg"></div>
			<div class="container" >
				<div class="row align-items-center">
					<div class="col-md-4 col-sm-6 text-center">
						<div class="studio-thumb">
							<img src="../static/img/AI.png" class="img-fluid" alt="">
						</div>
					</div>
					<div class="col-md-8 col-sm-6">
						<div class="studio-content">
							<div class="col-lg-5">
						<div>
							<h2>Request Retrain <hr> </h2>
                            <p id="choice" style = "display: none; font-size:20px;">
                                <input type="radio" name="disorder" value="0" checked="checked"> Fracture<br>
                                    <input type="radio" name="disorder" value="1"> Osteoarthritis<br>
                                    <input type="radio" name="disorder" value="2"> Dislocation
                            </p>
                            <a class="primary-btn retrainbutton" style="margin: 20px; display: none;">Retrain<span class="lnr lnr-sync"></span></a>

						</div>
					</div>

                    <div class="col-lg-6">
                        <div class="total-progress-bar">
                            <strong><p id="done" style="display: none; margin-left:220px; margin-top:40px; font-size: 45px;  color:#42f477;">Done!</p></strong>
                        </div>
                    </div>
                        </div>
					</div>
				</div>
			</div>
		</section>

		<!-- End Achivement Area --
		<!-- Start studio Area -->
		<section class="section-gap studio-area studio-area3" id = "statistics">
			<div class="overlay overlay-bg"></div>
			<div class="container" >
				<div class="row align-items-center">
					<div class="col-md-4 col-sm-6 text-center">
						<div class="studio-thumb">
							<img src="../static/img/file.png" class="img-fluid" alt="">
						</div>
					</div>
					<div class="col-md-8 col-sm-6">
						<div class="studio-content">
							<h2 style="font-size:35px;">Statistics <hr></h2>
							<p id="result_stat" style="color: black; font-size:35px; float:left;"></p>
							<strong><p id="stat_res" style="color: red;  font-size:35px; float:left;"></p></strong>
                        </div>
					</div>
				</div>
			</div>
		</section>
		<!-- End studio Area -->

		</div>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
		<script src="../static/js/vendor/bootstrap.min.js"></script>
		<script src="../static/js/jquery.ajaxchimp.min.js"></script>
		<script src="../static/js/owl.carousel.min.js"></script>
		<script src="../static/js/jquery.nice-select.min.js"></script>
		<script src="../static/js/jquery.magnific-popup.min.js"></script>
		<script src="../static/js/main.js"></script>

<script>


var crop_max_width = 400;
var crop_max_height = 400;
var jcrop_api;
var canvas;
var context;
var image;

var prefsize;

$("#file").change(function() {
  loadImage(this);
});

function loadImage(input) {
$('#result').text("");
$('#datares').text("");
$("#choice").hide();
$(".retrainbutton").hide();
$("#done").hide();



  if (input.files && input.files[0]) {
    var reader = new FileReader();
    canvas = null;
    reader.onload = function(e) {
      image = new Image();
      image.onload = validateImage;
      image.src = e.target.result;
    }
    reader.readAsDataURL(input.files[0]);
  }
}

function dataURLtoBlob(dataURL) {
  var BASE64_MARKER = ';base64,';
  if (dataURL.indexOf(BASE64_MARKER) == -1) {
    var parts = dataURL.split(',');
    var contentType = parts[0].split(':')[1];
    var raw = decodeURIComponent(parts[1]);

    return new Blob([raw], {
      type: contentType
    });
  }
  var parts = dataURL.split(BASE64_MARKER);
  var contentType = parts[0].split(':')[1];
  var raw = window.atob(parts[1]);
  var rawLength = raw.length;
  var uInt8Array = new Uint8Array(rawLength);
  for (var i = 0; i < rawLength; ++i) {
    uInt8Array[i] = raw.charCodeAt(i);
  }

  return new Blob([uInt8Array], {
    type: contentType
  });
}

function validateImage() {
  if (canvas != null) {
    image = new Image();
    image.onload = restartJcrop;
    image.src = canvas.toDataURL('image/png');
  }
  else restartJcrop();
}

function restartJcrop() {
  if (jcrop_api != null) {
    jcrop_api.destroy();
  }
  $("#views").empty();
  $("#views").append("<canvas id=\"canvas\">");
  canvas = $("#canvas")[0];
  context = canvas.getContext("2d");
  canvas.width = image.width;
  canvas.height = image.height;
  context.drawImage(image, 0, 0);

  $("#canvas").Jcrop({
    onSelect: selectcanvas,
    onRelease: clearcanvas,
    boxWidth: crop_max_width,
    boxHeight: crop_max_height
  }, function() {
    jcrop_api = this;
  });
  clearcanvas();
}

function clearcanvas() {
  prefsize = {
    x: 0,
    y: 0,
    w: canvas.width,
    h: canvas.height,
  };
}

function selectcanvas(coords) {
  prefsize = {
    x: Math.round(coords.x),
    y: Math.round(coords.y),
    w: Math.round(coords.w),
    h: Math.round(coords.h)
  };
}

function applyCrop() {
  canvas.width = prefsize.w;
  canvas.height = prefsize.h;
  context.drawImage(image, prefsize.x, prefsize.y, prefsize.w, prefsize.h, 0, 0, canvas.width, canvas.height);
  validateImage();
}

function applyScale(scale) {
  if (scale == 1) return;
  canvas.width = canvas.width * scale;
  canvas.height = canvas.height * scale;
  context.drawImage(image, 0, 0, canvas.width, canvas.height);
  validateImage();
}

function applyRotate() {
  canvas.width = image.height;
  canvas.height = image.width;
  context.clearRect(0, 0, canvas.width, canvas.height);
  context.translate(image.height / 2, image.width / 2);
  context.rotate(Math.PI / 2);
  context.drawImage(image, -image.width / 2, -image.height / 2);
  validateImage();
}

function applyHflip() {
  context.clearRect(0, 0, canvas.width, canvas.height);
  context.translate(image.width, 0);
  context.scale(-1, 1);
  context.drawImage(image, 0, 0);
  validateImage();
}

function applyVflip() {
  context.clearRect(0, 0, canvas.width, canvas.height);
  context.translate(0, image.height);
  context.scale(1, -1);
  context.drawImage(image, 0, 0);
  validateImage();
}

$("#cropbutton").click(function(e) {
  applyCrop();
});
$("#scalebutton").click(function(e) {
  var scale = prompt("Scale Factor:", "1");
  applyScale(scale);
});
$("#rotatebutton").click(function(e) {
  applyRotate();
});
$("#hflipbutton").click(function(e) {
  applyHflip();
});
$("#vflipbutton").click(function(e) {
  applyVflip();
});


	   		$(".clearbutton").click(function(){
	   			var $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
	   			var canvasObj = document.getElementById("canvas");
	   			var img = canvasObj.toDataURL();
	   			$.ajax({
	   				type: "POST",
	   				url: $SCRIPT_ROOT + "/upload/",
	   				data: JSON.stringify(img),
	   				dataType: 'json',
	   				    success: function(data) {
                        $('#result').text('Predicted Classification:');
	   					$('#datares').text(data);
	   					$("#choice").show();
	   					$(".retrainbutton").show();
	   					$('#datares').text(data[0]);
	   					$('#result_stat').text('Probability:');
                        $('#stat_res').text(data[1]);
                        },
                        error: function(data) {
                          alert("Error");
                        }
	   			});
	   		});


	   		$(".retrainbutton").click(function(){
	   			var $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
	   			var canvasObj = document.getElementById("canvas");
	   			var img = canvasObj.toDataURL();
	   			var choice = $("input[type=radio][name=disorder]:checked").val();
	   			$.ajax({
	   				type: "POST",
	   				url: $SCRIPT_ROOT + "/retrain/",
	   				data: {img: img, choice: choice},
	   				    success: function(data) {
                          <!--alert("Success");-->
                          $("#done").show();

                        },
                        error: function(data) {
                          alert("Error!no");
                        }
	   			});
	   		});

	</script>

	</body>
</html>
